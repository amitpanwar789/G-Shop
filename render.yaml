# render.yaml (Corrected using envVarGroups)
services:
  # --- User Service ---
  - name: user-service
    type: web
    env: docker
    plan: free
    repo: https://github.com/amitpanwar789/G-Shop # Replace with your repo URL
    autoDeploy: true
    dockerContext: ./backend/user-service
    dockerfilePath: ./backend/user-service/Dockerfile
    envVarGroups:              # Apply the environment group here
      - microservice-secrets   # Name of the Env Group created in Render
    envVars:                   # Define *only* non-group variables here
      - key: PORT
        value: 5000
      - key: NODE_ENV
        value: production

  # --- Product Service ---
  - name: product-service
    type: web
    env: docker
    plan: free
    repo: https://github.com/amitpanwar789/G-Shop
    autoDeploy: true
    dockerContext: ./backend/product-service
    dockerfilePath: ./backend/product-service/Dockerfile
    envVarGroups:              # Apply the environment group here
      - microservice-secrets   # Name of the Env Group created in Render
    envVars:                   # Define *only* non-group variables here
      - key: PORT
        value: 5001
      - key: NODE_ENV
        value: production

  # --- Order Service ---
  - name: order-service
    type: web
    env: docker
    plan: free
    repo: https://github.com/amitpanwar789/G-Shop
    autoDeploy: true
    dockerContext: ./backend/order-service
    dockerfilePath: ./backend/order-service/Dockerfile
    envVarGroups:              # Apply the environment group here
      - microservice-secrets   # Name of the Env Group created in Render
    envVars:                   # Define *only* non-group variables here
      - key: PORT
        value: 5003
      - key: NODE_ENV
        value: production

  # --- Nginx Reverse Proxy ---
  - name: nginx
    type: web
    env: docker
    plan: free
    repo: https://github.com/amitpanwar789/G-Shop
    autoDeploy: true
    dockerContext: ./backend/nginx
    dockerfilePath: ./backend/nginx/Dockerfile
    # Nginx likely doesn't need the shared secrets group

  # --- Optional: Frontend Static Site ---
  # (Include this section if deploying frontend as a static site)
  # - name: frontend
  #   type: static
  #   repo: https://github.com/amitpanwar789/G-Shop
  #   autoDeploy: true
  #   rootDir: ./frontend
  #   buildCommand: npm install && npm run build # Adjust as needed
  #   publishDir: ./frontend/build             # Adjust as needed
  #   routes:
  #     - type: rewrite
  #       source: /*
  #       destination: /index.html